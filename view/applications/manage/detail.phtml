<?php 
      use Applications\Entity\StatusInterface as Status;
      
      $this->headTitle($this->translate('Details'));
      $this->headScript()->appendFile($this->basePath('Applications/js/applications.manage.detail.js'));
?>
<h1><?= $this->translate('application details') ?></h1>

<div id="forward-email-result" class="hide alert"></div>
<form class="row" id="forward-email-form" action="<?php echo $this->url('lang/applications/detail',array(), true)?>" method="get">
    
    <div id="forward-email" class="span12 text-right input-prepend input-append">
        
            <span class="add-on" 
               data-toggle="popover" 
               data-trigger="hover focus click"
               data-placement="bottom" 
               title="<?php echo $this->translate('Enter an email address')?>"
               data-content="<?php echo $this->translate('This application will be send as an email to the given address in a layout similar to that on this page with all attachments included.')?>"
            >@</span>
            <input type="hidden" name="action" value="forward">
            <input class="span3" id="forward-email-input" name="email" type="email">
            <button class="btn" type="submit"><i class="icon-share"></i> <?php echo $this->translate('Forward')?></button>
        
    </div>
   
</form>

<div class="row-fluid">
    <div class="span3"><?= $this->translate('State')?>:</div>
    <div class="span9"><p><?php echo $this->translate($application->status->name) ?></p></div>
</div>
<div class="row-fluid">
    <div class="span3"></div>
    <div class="span9">
        <div id="state-actions" class="btn-group">
        <?php $status = $application->status->getName();
        
            $actionButtons = array(
                Status::CONFIRMED => array(
                    'href' => $this->url(
                                'lang/applications/detail/status',
                                array('status' => Status::CONFIRMED),
                                true
                              ),
                    'label' => $this->translate('Confirm'),
                    'title' => $this->translate('Confirm the receipt'),
                ),
                Status::INVITED => array(
                    'href' => $this->url(
                                'lang/applications/detail/status',
                                array('status' => Status::INVITED),
                                true
                              ),
                    'label' => $this->translate('Invite'),
                    'title' => $this->translate('Invite the applicant'),
                ),
                Status::REJECTED => array(
                    'href' => $this->url(
                                'lang/applications/detail/status',
                                array('status' => Status::REJECTED),
                                true
                              ),
                    'label' => $this->translate('Reject'),
                    'title' => $this->translate('Reject the applicant'),
                ),
                    
            );

            foreach ($actionButtons as $targetStatus => $spec):
                if ($status == $targetStatus): continue; endif?>
              
            <button class="btn" 
                    data-href="<?php echo $spec['href']?>"
                    <?php if (isset($spec['title'])):?>
                    data-title="<?php echo $spec['title']?>"
                    data-toggle="modal"
                    data-target="#mail-box"
                    <?php endif ?>
            ><?php echo $spec['label'] ?></button>
                
            <?php endforeach ?>
        
            
        </div>
    </div>
</div>
<div id="mail-box" class="modal hide fade" tabindex="-1">
                 <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h3 id="mail-box-label"><?php echo $this->translate('Invite the applicant') ?></h3>
                </div>
                <div id="mail-box-content" class="modal-body"></div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true"><?php echo $this->translate('Cancel') ?></button>
                    <button class="btn btn-primary" onclick="$('#applicant-mail').submit()"><?php echo $this->translate('Send mail') ?></button>
                </div>
            </div>
        
<br />
<div class="row-fluid">
    <div class="span3"><?php echo $this->translate('State history') ?>:</div>
    <div class="span9">
        <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th><?php echo $this->translate('Date') ?></th>
                <th><?php echo $this->translate('State') ?></th>
                <th><?php echo $this->translate('Comment') ?></th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($this->application->history as $history): ?>
            <tr>
                <td><?php echo $this->formatDate($history->date)?></td>
                <td><?php echo $history->status ?></td>
                <td><?php echo $history->message ?></td>
            </tr>
            <?php endforeach ?>
        </tbody>
        </table>
    </div>
</div>
<div class="row-fluid">
    <div class="span3"><?= $this->translate('date of receipt')?>:</div>
    <div class="span6"><?=  strftime('%x %X', $application->dateCreated->getTimestamp()); ?></div>
</div>
<div class="row-fluid">
    <div class="span3"><?= $this->translate('last modification date')?>:</div>
    <div class="span6"><?=  strftime('%x %X', $application->dateModified->getTimestamp()); ?></div>
</div>

<h2><?= $this->translate('personal information')?></h2>
<div class="row-fluid">
<div class="span9">
<div class="row-fluid">
<div class="span3"><?= $this->translate('name')?>:</div>
<div class="span3"><?=  $this->application->contact->firstName.' '.$this->application->contact->lastName ?></div>
</div>
<div class="row-fluid">
<div class="span3"><?= $this->translate('E-Mail')?>:</div>
<div class="span3"><?=  $this->application->contact->email ?></div>
</div>
<div class="row-fluid">
<div class="span3"><?= $this->translate('Phone')?>:</div>
<div class="span3"><?=  $this->application->contact->phone ?></div>
</div>
</div>
<div class="span3">
    <?if ($this->application->contact->imageId):?>
    <img src="/file/applications/<?php echo $this->application->contact->imageId ?>" class="img-polaroid" />
    <?endif?>
</div>
</div>

<h2><?=$this->translate('Summary')?></h2>
<div class="row-fluid show-grid">
<div class="span12"><pre>
<?php echo $this->application->summary ?>
</pre>
</div>
</div>


<div class="row-fluid show-grid">
<h2><?= $this->translate('work experience')?></h2>
      
<?php foreach( $this->application->cv->employments as $employment): ?>
<div class="span3"><?= $employment->startDate ?></div> <div class="span3"><?= $employment->endDate ?></div>
<div><?=  $employment->description ?></div>

<?php endforeach; // employments?>    
</div>
<div class="row-fluid show-grid">

<h2><?= $this->translate('education and training')?></h2>

<?php foreach( $this->application->cv->educations as $education): ?>
  <div class="span3"><?= $education->startDate ?></div> <div class="span3"><?= $education->endDate ?></div>
  <div><?=  $education->description ?></div>
<?php endforeach; // eucations?>    
</div>


<div class="row-fluid show-grid">

<h2><?= $this->translate('personal skills')?></h2>

<?php foreach( $this->application->cv->skills as $kill): ?>
  <div class="span3"><?=$this->translate('native language')?></div> 
  <div class="span3">TODO</div>
<?php endforeach; // skills?>
    
</div>



<h2><?= $this->translate('Attachments')?></h2>

<?php foreach( $this->application->attachments as $attachment): ?>
<div class="row-fluid show-grid">
  <div class="span3">
    <a href="<?php echo $this->url('file', array(
        'filestore' => 'applications', 
        'fileId' => $attachment->id,
        'fileName' => $attachment->name
    ))?>"><?php echo $attachment->name ?></a></div>
    <div class="span3"><?php echo $attachment->type?></div>
    <div class="span3"><?php echo $attachment->prettySize ?></div>
</div>
<?php endforeach; // skills?>
    

